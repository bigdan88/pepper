import{S as me,i as ve,s as pe,k as S,a as R,q,l as w,m as C,h as I,c as M,r as H,J as ne,n as p,b as ge,G as h,u as ie,H as le,y as U,z as X,p as Ee,A as Z,K as he,L as oe,M as ye,g as k,f as ee,d as V,B as z,N as Se,O as we,v as te,w as Ie}from"../chunks/index.2ee51f7d.js";function Ce(n){let s,r,t,e,a,i,g,y,m=n[0]==="user"?"Me":"Bot",o,L,N,T,E,P;return{c(){s=S("div"),r=S("div"),t=S("div"),e=S("img"),g=R(),y=S("div"),o=q(m),L=R(),N=S("div"),T=q(n[1]),this.h()},l(c){s=w(c,"DIV",{class:!0});var v=C(s);r=w(v,"DIV",{class:!0});var D=C(r);t=w(D,"DIV",{class:!0});var O=C(t);e=w(O,"IMG",{src:!0,alt:!0}),O.forEach(I),D.forEach(I),g=M(v),y=w(v,"DIV",{class:!0});var G=C(y);o=H(G,m),G.forEach(I),L=M(v),N=w(v,"DIV",{class:!0});var x=C(N);T=H(x,n[1]),x.forEach(I),v.forEach(I),this.h()},h(){ne(e.src,a="https://ui-avatars.com/api/?name="+(n[0]==="user"?"Me":"B"))||p(e,"src",a),p(e,"alt",i=n[0]+" avatar"),p(t,"class","w-10 rounded-full"),p(r,"class","chat-image avatar"),p(y,"class","chat-header"),p(N,"class",E="chat-bubble "+(n[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary")),p(s,"class",P="chat "+(n[0]==="user"?"chat-end":"chat-start")+" justify-end")},m(c,v){ge(c,s,v),h(s,r),h(r,t),h(t,e),h(s,g),h(s,y),h(y,o),h(s,L),h(s,N),h(N,T)},p(c,[v]){v&1&&!ne(e.src,a="https://ui-avatars.com/api/?name="+(c[0]==="user"?"Me":"B"))&&p(e,"src",a),v&1&&i!==(i=c[0]+" avatar")&&p(e,"alt",i),v&1&&m!==(m=c[0]==="user"?"Me":"Bot")&&ie(o,m),v&2&&ie(T,c[1]),v&1&&E!==(E="chat-bubble "+(c[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary"))&&p(N,"class",E),v&1&&P!==(P="chat "+(c[0]==="user"?"chat-end":"chat-start")+" justify-end")&&p(s,"class",P)},i:le,o:le,d(c){c&&I(s)}}}function Le(n,s,r){let{type:t}=s,{message:e}=s;return n.$$set=a=>{"type"in a&&r(0,t=a.type),"message"in a&&r(1,e=a.message)},[t,e]}class K extends me{constructor(s){super(),ve(this,s,Le,Ce,pe,{type:0,message:1})}}var _e={};(function(n){var s=function(r,t){if(!(this instanceof s))return new s(r,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=r,t=t||{},this.headers=t.headers||{},this.payload=t.payload!==void 0?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,a){this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].indexOf(a)===-1&&this.listeners[e].push(a)},this.removeEventListener=function(e,a){if(this.listeners[e]!==void 0){var i=[];this.listeners[e].forEach(function(g){g!==a&&i.push(g)}),i.length===0?delete this.listeners[e]:this.listeners[e]=i}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var a="on"+e.type;return this.hasOwnProperty(a)&&(this[a].call(this,e),e.defaultPrevented)?!1:this.listeners[e.type]?this.listeners[e.type].every(function(i){return i(e),!e.defaultPrevented}):!0},this._setReadyState=function(e){var a=new CustomEvent("readystatechange");a.readyState=e,this.readyState=e,this.dispatchEvent(a)},this._onStreamFailure=function(e){var a=new CustomEvent("error");a.data=e.currentTarget.response,this.dispatchEvent(a),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(e){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(e);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var a=this.xhr.responseText.substring(this.progress);this.progress+=a.length,a.split(/(\r\n|\r|\n){2}/g).forEach(function(i){i.trim().length===0?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=i}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||e.length===0)return null;var a={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(g){g=g.trimRight();var y=g.indexOf(this.FIELD_SEPARATOR);if(!(y<=0)){var m=g.substring(0,y);if(m in a){var o=g.substring(y+1).trimLeft();m==="data"?a[m]+=o:a[m]=o}}}.bind(this));var i=new CustomEvent(a.event);return i.data=a.data,i.id=a.id,i},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};n.SSE=s})(_e);function ue(n,s,r){const t=n.slice();return t[11]=s[r],t}function ce(n){let s,r;return s=new K({props:{type:n[11].role,message:n[11].content}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),r=!0},p(t,e){const a={};e&8&&(a.type=t[11].role),e&8&&(a.message=t[11].content),s.$set(a)},i(t){r||(k(s.$$.fragment,t),r=!0)},o(t){V(s.$$.fragment,t),r=!1},d(t){z(s,t)}}}function fe(n){let s,r;return s=new K({props:{type:"assistant",message:n[1]}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),r=!0},p(t,e){const a={};e&2&&(a.message=t[1]),s.$set(a)},i(t){r||(k(s.$$.fragment,t),r=!0)},o(t){V(s.$$.fragment,t),r=!1},d(t){z(s,t)}}}function de(n){let s,r;return s=new K({props:{type:"assistant",message:"Loading.."}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),r=!0},i(t){r||(k(s.$$.fragment,t),r=!0)},o(t){V(s.$$.fragment,t),r=!1},d(t){z(s,t)}}}function Ne(n){let s,r,t,e,a,i,g,y,m,o,L,N,T,E,P,c,v,D,O,G,x,Q,F,W,se;L=new K({props:{type:"assistant",message:"Hello, ask me anything you want!"}});let B=n[3],f=[];for(let l=0;l<B.length;l+=1)f[l]=ce(ue(n,B,l));const be=l=>V(f[l],1,1,()=>{f[l]=null});let _=n[1]&&fe(n),b=n[2]&&de();return{c(){s=S("div"),r=S("div"),t=S("h1"),e=q("Pepper"),a=R(),i=S("p"),g=q("Powered by gpt-3.5-turbo"),y=R(),m=S("div"),o=S("div"),U(L.$$.fragment),N=R();for(let l=0;l<f.length;l+=1)f[l].c();T=R(),_&&_.c(),E=R(),b&&b.c(),P=R(),c=S("div"),v=R(),D=S("form"),O=S("input"),G=R(),x=S("button"),Q=q("Send"),this.h()},l(l){s=w(l,"DIV",{class:!0});var d=C(s);r=w(d,"DIV",{});var u=C(r);t=w(u,"H1",{class:!0});var $=C(t);e=H($,"Pepper"),$.forEach(I),a=M(u),i=w(u,"P",{class:!0});var re=C(i);g=H(re,"Powered by gpt-3.5-turbo"),re.forEach(I),u.forEach(I),y=M(d),m=w(d,"DIV",{class:!0});var j=C(m);o=w(j,"DIV",{class:!0});var A=C(o);X(L.$$.fragment,A),N=M(A);for(let Y=0;Y<f.length;Y+=1)f[Y].l(A);T=M(A),_&&_.l(A),E=M(A),b&&b.l(A),A.forEach(I),P=M(j),c=w(j,"DIV",{class:!0}),C(c).forEach(I),j.forEach(I),v=M(d),D=w(d,"FORM",{class:!0});var J=C(D);O=w(J,"INPUT",{type:!0,class:!0,style:!0}),G=M(J),x=w(J,"BUTTON",{type:!0,class:!0});var ae=C(x);Q=H(ae,"Send"),ae.forEach(I),J.forEach(I),d.forEach(I),this.h()},h(){p(t,"class","text-2xl font-bold w-full text-center"),p(i,"class","text-sm italic"),p(o,"class","flex flex-col gap-2"),p(c,"class",""),p(m,"class","h-[500px] w-full bg-gray-900 rounded-md p-4 overflow-y-auto flex flex-col gap-4"),p(O,"type","text"),p(O,"class","input input-bordered w-full"),Ee(O,"color","black"),p(x,"type","submit"),p(x,"class","btn btn-accent"),p(D,"class","flex w-full rounded-md gap-4 bg-gray-900 p-4"),p(s,"class","flex flex-col pt-4 w-full px-8 items-center gap-2")},m(l,d){ge(l,s,d),h(s,r),h(r,t),h(t,e),h(r,a),h(r,i),h(i,g),h(s,y),h(s,m),h(m,o),Z(L,o,null),h(o,N);for(let u=0;u<f.length;u+=1)f[u].m(o,null);h(o,T),_&&_.m(o,null),h(o,E),b&&b.m(o,null),h(m,P),h(m,c),n[6](c),h(s,v),h(s,D),h(D,O),he(O,n[0]),h(D,G),h(D,x),h(x,Q),F=!0,W||(se=[oe(O,"input",n[7]),oe(D,"submit",ye(n[8]))],W=!0)},p(l,[d]){if(d&8){B=l[3];let u;for(u=0;u<B.length;u+=1){const $=ue(l,B,u);f[u]?(f[u].p($,d),k(f[u],1)):(f[u]=ce($),f[u].c(),k(f[u],1),f[u].m(o,T))}for(te(),u=B.length;u<f.length;u+=1)be(u);ee()}l[1]?_?(_.p(l,d),d&2&&k(_,1)):(_=fe(l),_.c(),k(_,1),_.m(o,E)):_&&(te(),V(_,1,1,()=>{_=null}),ee()),l[2]?b?d&4&&k(b,1):(b=de(),b.c(),k(b,1),b.m(o,null)):b&&(te(),V(b,1,1,()=>{b=null}),ee()),d&1&&O.value!==l[0]&&he(O,l[0])},i(l){if(!F){k(L.$$.fragment,l);for(let d=0;d<B.length;d+=1)k(f[d]);k(_),k(b),F=!0}},o(l){V(L.$$.fragment,l),f=f.filter(Boolean);for(let d=0;d<f.length;d+=1)V(f[d]);V(_),V(b),F=!1},d(l){l&&I(s),z(L),Se(f,l),_&&_.d(),b&&b.d(),n[6](null),W=!1,we(se)}}}function Oe(n,s,r){let t="",e="",a=!1,i=[],g;function y(){setTimeout(function(){g.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},100)}const m=async()=>{r(2,a=!0),r(3,i=[...i,{role:"user",content:t}]);const E=new _e.SSE("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:i})});r(0,t=""),E.addEventListener("error",o),E.addEventListener("message",P=>{y();try{if(r(2,a=!1),P.data==="[DONE]"){r(3,i=[...i,{role:"assistant",content:e}]),r(1,e="");return}const c=JSON.parse(P.data),[{delta:v}]=c.choices;v.content&&r(1,e=(e??"")+v.content)}catch(c){o(c)}}),E.stream(),y()};function o(E){r(2,a=!1),r(0,t=""),r(1,e=""),console.error(E)}function L(E){Ie[E?"unshift":"push"](()=>{g=E,r(4,g)})}function N(){t=this.value,r(0,t)}return[t,e,a,i,g,m,L,N,()=>m()]}class De extends me{constructor(s){super(),ve(this,s,Oe,Ne,pe,{})}}export{De as default};
